{"version":3,"sources":["../src/icingaweb2_ctrl.js"],"names":["PanelCtrl","_","Icingaweb2Ctrl","$scope","$injector","panelDefaults","icingaweb2Url","icingaweb2User","icingaweb2Pass","serviceAck","showCritical","showWarning","showUnknown","showOK","services","Array","defaults","panel","events","on","onInitEditMode","bind","updateList","onPanelTeardown","render","addEditorTab","$timeout","cancel","nextTickPromise","user","password","tok","hash","btoa","url","serviceState","authHeader","basicAuthString","constructedUrl","result","$","ajax","type","async","dataType","headers","service","push","undefined","handled","URL","getServices","console","log","scope","elem","$panelContainer","find","bgColor","css","templateUrl"],"mappings":"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","file":"icingaweb2_ctrl.js","sourcesContent":["import {PanelCtrl} from 'app/plugins/sdk';\n//import moment from 'moment';\nimport _ from 'lodash';\nimport './css/icingaweb2-panel.css!';\n\nexport class Icingaweb2Ctrl extends PanelCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    var panelDefaults = {\n     icingaweb2Url: 'icinga2.in.your.domain',\n     icingaweb2User: 'user',\n     icingaweb2Pass: \"pass\", \n     serviceAck: 'Handled',\n     showCritical: true,\n     showWarning: false,\n     showUnknown: false,\n     showOK: false\n    };\n\n    var services=new Array();\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.updateList.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('panel-initialized', this.render.bind(this));\n\n    \n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/cinek810-icingaweb2-panel/partials/editor.html', 2);\n  }\n\n  onPanelTeardown() {\n    this.$timeout.cancel(this.nextTickPromise);\n  }\n \n  basicAuthString(user, password) {\n    var tok = user + \":\" + password;\n    var hash = btoa(tok);\n    return \"Basic \" + hash;\n }\n\ngetServices(url,serviceState){\n\tvar authHeader =this.basicAuthString(this.panel.icingaweb2User,this.panel.icingaweb2Pass) ;\n\tvar constructedUrl=url+'service_state='+serviceState;\n\n\tvar result = $.ajax({ \n             type: \"GET\",\n             async: false,\n             dataType: 'json',\n             headers: { 'Authorization':  authHeader },\n             url: constructedUrl })\n\n\n\n\tfor(var service in result[\"responseJSON\"] )\n\t{\n\t\tthis.services.push(result[\"responseJSON\"][service]);\n\t\t\n\t}\n}\n\nupdateList() {\n\t/* Initialize or clear the list of services to be presernted*/\n\tif (this.services == undefined) {\n\t\tthis.services=new Array();\n\t}\t\n\telse {\n\t\tthis.services= [] ;\n\t}\n\n\n\t/*Construct URL - handled/unhandled services*/\n\tif (this.panel.serviceAck == 'Handled') {\n\t\tvar handled='service_handled=1&'\n\t}\n\telse if (this.panel.serviceAck == \"Unhandled\") {\n\t\tvar handled='service_handled=0&'\n\t}\n\telse {\n\t\tvar handled=''\n\t}\n\n\tvar URL=\"https://\"+this.panel.icingaweb2Url+'/monitoring/list/services?format=json&'+handled\n\t\n\t/*Add servies in different state, depending on user choice*/\n\tif (this.panel.showCritical == true ){ \n\t\tthis.getServices(URL,2)\n\t\tconsole.log(\"Adding criticals\"+this.panel.showCritical)\n\t}\n\tif (this.panel.showWarning == true){\n\t\tthis.getServices(URL,1)\n\t\tconsole.log(\"Adding warnings\"+this.panel.showWarning)\n\t}\n\tif (this.panel.showUnknown == true ) {\n\t\tthis.getServices(URL,3)\n\t\tconsole.log(\"Adding unknowns\"+this.panel.showUnknown)\n\t}\n\tif (this.panel.showOK == true ) {\n\t\tthis.getServices(URL,0)\n\t\tconsole.log(\"Adding OKs\"+this.panel.showOK)\n\t}\n\t//console.log(URL);\n}\n\n\n  link(scope, elem) {\n    this.events.on('render', () => {\n      const $panelContainer = elem.find('.panel-container');\n\n      if (this.panel.bgColor) {\n        $panelContainer.css('background-color', this.panel.bgColor);\n      } else {\n        $panelContainer.css('background-color', '');\n      }\n    });\n  }\n}\n\nIcingaweb2Ctrl.templateUrl = 'partials/module.html';\n"]}